% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_workflows.R
\name{run_model_workflow}
\alias{run_model_workflow}
\title{Run one full iSDM workflow}
\usage{
run_model_workflow(
  species_datasets_list,
  matching = FALSE,
  covariates_i = NULL,
  covariates_t = NULL,
  covariates_it = NULL,
  inclDet = FALSE,
  inclPhenology = FALSE,
  nburnin = 3000,
  niter = 5000,
  plot_outputs = FALSE,
  years = NULL,
  tag = NULL
)
}
\arguments{
\item{species_datasets_list}{A named list of data frames, each containing species observation data including site IDs, years, and detection histories.}

\item{matching}{Logical. If \code{TRUE}, allows environmental data to be matched from the nearest 1km grid cell when unavailable at a site.}

\item{covariates_i}{Optional character vector. Names of spatial (site-level) covariates to include in the state model.}

\item{covariates_t}{Optional character vector. Names of temporal (year-level) covariates to include in the state model.}

\item{covariates_it}{Optional character vector. Names of spatiotemporal (site Ã— year) covariates to include in the state model.}

\item{inclDet}{Logical. Whether to include detection covariates in the observation model. Defaults to \code{FALSE}.}

\item{inclPhenology}{Logical. Whether to include a seasonal phenology curve in the detection model (if date data is available).}

\item{nburnin}{Integer. Number of burn-in iterations for MCMC. Default is \code{3000}.}

\item{niter}{Integer. Total number of MCMC iterations. Default is \code{5000}.}

\item{plot_outputs}{Logical. Whether to plot the predicted occupancy time series and spatial map. Defaults to \code{FALSE}.}

\item{years}{Optional vector of years for plotting occupancy trends.}

\item{tag}{Optional character string used to tag the model estimates (e.g., for naming output models).}
}
\value{
A list with the following elements:
\describe{
\item{params}{A data frame of posterior parameter estimates (mean and SD), filtered to include interpretable outputs only.}
\item{waic}{A data frame containing the WAIC value for model predictive accuracy.}
}
}
\description{
This is the main workflow function to prepare, fit, and evaluate the integrated species distribution model (iSDM) using NIMBLE. It performs data validation, model input preparation, model compilation, MCMC execution, convergence diagnostics, and optional visualisation.
}
\details{
This function manages the full pipeline to run an iSDM using NIMBLE. It includes:
\itemize{
\item Data filtering and site validation via \code{filter_valid_sites()}.
\item Extraction and scaling of covariates via \code{format_state_covariates()} and \code{format_det_covariates()}.
\item Model building with \code{build_imod()} and \code{defineModel()}.
\item MCMC fitting via \code{run_imod()}.
\item Convergence checks (Rhat, ESS) and WAIC calculation.
\item Optional visualisation of predictions with \code{plot_occupancy_trend()} and \code{plot_occupancy_map()}.
}

Assumes required helper functions and data processing utilities are defined and available in your package (e.g. \code{build_lookups()}, \code{build_map_layers()}, etc.).
}
\examples{
\dontrun{
run_model_workflow(
  species_datasets_list = list(dataset1 = df1, dataset2 = df2),
  covariates_i = c("elevationcs", "latcs"),
  covariates_t = c("tas_MATcs"),
  inclDet = TRUE,
  inclPhenology = TRUE,
  plot_outputs = TRUE,
  years = 2010:2020,
  tag = "run1"
)
}

}
